$(document).ready(function () {
  $("#liquor_type").select2({
    width: "100%",
    placeholder: "Select a liquor type",
  });
  $("#liquor_brand").select2({
    width: "100%",
    placeholder: "Select liquor brand",
  });
  $("#entity_type").select2({
    width: "100%",
    placeholder: "Select an entity type",
  });
  $("#entity").select2({ width: "100%", placeholder: "Select an entity" });
  $("#select_ml").select2({ width: "100%", placeholder: "Select ml" });

  $("#holdLiquorImage").css(
    "background-image",
    "url(" + DOMAIN + "liquor_images/liquor_preview.jpg" + ")"
  );
  // on change of liquor select fetch liquor_brand details
  $("#liquor_type").change(function () {
    checkInputEmpty("liquor_type", "Kindly select liquor type");
    var liquor_brand_id = $(this).val();
    $("#liquor_brand").val("").trigger("change");
    $.ajax({
      url: DOMAIN + "master/Liquor_mapping/getLiquorBrandList",
      method: "POST",
      data: { csrf_test_name: csrfHash, liquor_brand_id: liquor_brand_id },
      success: function (response) {
        var result = JSON.parse(response);
        var liquor_brand_option_html = "<option></option>";
        for (var i = 0; i < result.length; i++) {
          liquor_brand_option_html +=
            "<option value='" +
            result[i].id +
            "'>" +
            result[i].liquor_name +
            "</option>";
        }
        $("#liquor_brand").html(liquor_brand_option_html);
      },
      errror: function () {
        swal("Can't reach to the server");
      },
    });
  });

  $("#liquor_brand").change(function () {
    var value = $(this).val().split("#");
    console.log(value);

    var image_path =
      $(this).val() !== ""
        ? DOMAIN + value[1]
        : DOMAIN + "liquor_images/liquor_preview.jpg";

    console.log(image_path);
    $("#holdLiquorImage").css("background-image", "url(" + image_path + ")");
    // console.log(image_path)
  });
  // on change of entity select fetch entity_name details
  $("#entity_type").change(function () {
    checkInputEmpty("entity_type", "Kindly select entity type");
    var entity_name_id = $(this).val();
    $("#entity").val("").trigger("change");
    $.ajax({
      url: DOMAIN + "master/Liquor_mapping/getEntityList",
      method: "POST",
      data: { csrf_test_name: csrfHash, entity_name_id: entity_name_id },
      success: function (response) {
        var result = JSON.parse(response);
        var entity_option_html = "<option></option>";
        for (var i = 0; i < result.length; i++) {
          entity_option_html +=
            "<option value='" +
            result[i].id +
            "'>" +
            result[i].entity_name +
            "</option>";
        }
        $("#entity").html(entity_option_html);
      },
      errror: function () {
        swal("Can't reach to the server");
      },
    });
  });

  $("#entity").change(function () {
    var entity_id = $(this).val();
    console.log(entity_id);
  });

  $("#liquor_mapping_details").click(function (event) {
    event.preventDefault();

    var liquor_form_data = $("#" + this.id + "_form"); // fetching the form id

    submit_data_error_check = true;

    checkInputEmpty("liquor_type", "kindly select a liquor type");
    checkInputEmpty("liquor_brand", "kindly select a liquor brand");
    checkInputEmpty("entity_type", "kindly select a entity type");
    checkInputEmpty("entity", "kindly enter an entity");
    // checkInputEmpty('select_ml', 'kindly select ml')
    checkInputEmpty("moq", "kindly enter a minimum order quantity");
    checkInputEmpty("sell_price", "kindly enter a purchase price");
    checkInputEmpty("purchase_price", "kindly enter a sell price");
    checkInputEmpty("available_quantity", "kindly enter a available quantity");

    if (submit_data_error_check) {
      var action_url = liquor_form_data.attr("action");

      $.ajax({
        url: action_url,
        method: "POST",
        data: liquor_form_data.serialize(),
        dataType: "JSON",
        beforeSend: function () {
          $(this).attr("disabled", "disabled");
        },
        success: function (response) {
          $(this).removeAttr("disabled");
          console.log(response);
          //   return false
          if (!response.success) {
            $.each(response.messages, function (key, value) {
              var element = $("#" + key);
              element
                .closest("input,select")
                .removeClass("is-invalid")
                .addClass(value.length > 0 ? "is-invalid" : "is-valid")
                .find(".text-danger")
                .remove();
              element = $("#" + key + "_error");

              element.html(value);
            });
          } else {
            //             V_SWAL_MESSAGE: "Product added successfully"
            // V_SWAL_TITLE: "SUCCESS"
            // V_SWAL_TYPE: "success"
            if (response.model_response[0].V_SWAL_TYPE === "success") {
              //

              Swal.fire({
                title: response.model_response[0].V_SWAL_MESSAGE,
                text: "",
                icon: response.model_response[0].V_SWAL_TYPE,
                showConfirmButton: true,
                //                            toast: true
              }).then((result) => {
                /* Read more about isConfirmed, isDenied below */

                if (result.isConfirmed) {
                  window.location.href = DOMAIN + "master/Liquor_mapping";
                }
              });
            } else {
            }
          }
        },
        error: function (response) {
          $(this).removeAttr("disabled");
        },
      });

      console.log(action_url);
    } else {
      Swal.fire({
        title: "Incomplete form",
        text: "Kindly check all fields",
        icon: "warning",
      });
    }
  });
});
