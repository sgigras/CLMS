var cart_id = 0
// $('#select_order').select2({ 'width': '100%', 'placeholder': 'search order code' })

$('#select_order').change(function () {
  console.log("changed");
  console.log(page_hit);
  if (page_hit !== 'start') {
    $('#searchCartDetails').prop('disabled', true)
  }
  // checkInputEmpty('select_order', 'Kindly select a order code')
})

function checkPageHit() {
  console.log(page_hit);
  if (page_hit !== 'start') {
    console.log("inside if");
    $('#select_order').val(order_code)
    $('#searchCartDetails').trigger('click')
  }
}

$('#searchCartDetails').click(function (event) {
  event.preventDefault()
  console.log(page_hit)

  if (page_hit == 'start') {
    order_code = $('#select_order').val()
    console.log(order_code)
    // cart_id = $('#select_order').val()
    var empty_flag = (order_code !== '') ? false : true
  } else {
    $('#searchCartDetails').prop('disabled', true)
    empty_flag = false
  }

  console.log(order_code)

  if (!empty_flag) {
    $.ajax({
      url: DOMAIN + 'order/OrderDetails/fetchOrderDetails',
      method: 'POST',
      data: { csrf_test_name: csrfHash, page_label: page_label, order_code: order_code },
      dataType: 'html',
      success: function (response) {
        // console.log(response)
        // if (response != 'false') {
        $('#hold_cart_collapsible_view').html(response)
        // } else {
        //   console.log('else')
        //   Swal.fire("No liquors found for the given code", $order_code, "warning")
        // }
      },
      error: function (error) {
        console.log('error')
      }
    })
  } else {
    Swal.fire({
      title: 'Select Order Code',
      text: '',
      icon: 'warning'
    })
  }
})

function edit_order_delivery(cart_id) {
  // console.log('clicked')
  // return false
  // var cart_id = $('#select_order').val()
  var order_code = $('#select_order').val()
  var page_mode = 'order_summary_delivery'
  console.log(cart_id + '----' + order_code + '--' + page_mode)
  $.ajax({
    url: DOMAIN + 'order/OrderDetails/modifyCartDetails',
    method: 'POST',
    data: { csrf_test_name: csrfHash, order_code: order_code, page_mode: page_mode },
    success: function (response) {
      // console.log(response)
      window.location.href = DOMAIN + 'order/OrderDetails/fetchCartDetails'
    },
    error: function (error) {
      console.log(error)
    }
  })
}

function submit_order_delivery(cart_id) {
  // var cart_id = $('#select_order').val()
  var order_code = $('#select_order').val()
  var page_mode = 'order_summary_delivery'

  // console.log(cart_id + '----' + order_code + '--' + page_mode)
  $.ajax({
    url: DOMAIN + 'order/OrderDetails/completeDeliveryProcess',
    method: 'POST',
    data: { csrf_test_name: csrfHash, order_code: order_code, page_mode: page_mode },
    success: function (response) {
      console.log(response)
      var result = JSON.parse(response)
      var cart_type = result[0].V_CART_TYPE;
      console.log(result);
      // dispatchEvent()
      // return false;
      if (result[0].V_SWAL_TYPE == 'success') {
        Swal.fire({
          title: result[0].V_SWAL_TITLE,
          text: '',
          icon: result[0].V_SWAL_TYPE,
          confirmButtonText: 'Print Receipt',
        }).then(function () {
          if (cart_type === 'consumer') {
            window.location = DOMAIN + "order/OrderDetails/printReceipt";
          }
        });
      } else {
        Swal.fire({
          title: result[0].V_SWAL_TITLE,
          text: result[0].V_SWAL_TEXT,
          icon: result[0].V_SWAL_TYPE,
          confirmButtonText: 'OK',
        });
      }
    },
    error: function (error) {
      console.log(error)
    }
  })
}
