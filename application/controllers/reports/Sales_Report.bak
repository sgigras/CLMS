  <!-- //Author:Ujwal Jain
  //Subject:Sales Report Controller
  //Date:15-12-2021 -->

  <?php defined('BASEPATH') or exit('No direct script access allowed');
  class Sales_Report extends MY_Controller
  {

    public function __construct()
    {
      parent::__construct();

      $this->load->model('Reports/Sales_report_model', 'Sales');
    }

    public function index(){

      if($this->input->post('submit')){
  
        $this->form_validation->set_rules('start_date', 'Start Date', 'trim|required');
        $this->form_validation->set_rules('end_date', 'End Date', 'trim|required');
  
        
        if ($this->form_validation->run() == FALSE) {
          $data = array(
            'errors' => validation_errors()
          );
          $this->session->set_flashdata('form_data', $_POST);
          $this->session->set_flashdata('errors', $data['errors']);
          redirect(base_url('reports/Sales_Report'),'refresh');
        }
        else{
  
      $start_date=$this->input->post('start_date');
      $end_date=$this->input->post('end_date');
      // $entity_id=24;
      $entity_id=$this->session->userdata('entity_id');
      $result['details']=$this->Sales->sales_report($start_date, $end_date, $entity_id);
      $result['cost_details']=$this->Sales->cost_data($start_date, $end_date, $entity_id);
      $this->session->set_flashdata('form_data', $_POST);
      if(sizeof($result)>0){
       $this->load->view('admin/includes/_header');
       $this->load->view('reports/sales_report',$result);
       $this->load->view('admin/includes/_footer');
     }
  
   }
  
  }
  else
  {
    $this->load->view('admin/includes/_header');
    $this->load->view('reports/sales_report');
    $this->load->view('admin/includes/_footer');
  }
  
  }
  }
