<?php defined('BASEPATH') OR exit('No direct script access allowed');

class Import_excel extends MY_Controller {

	public function __construct(){

		parent::__construct();
		auth_check(); // check login auth
        $this->load->model('admin/import_model');
        $this->load->library('excel');
	}

	//----------------------------------------------------------------
	public function index(){

		$data['title'] = 'Simple Table';

		$this->load->view('admin/includes/_header');
		$this->load->view('admin/uidesign/excel_file_upload');
		$this->load->view('admin/includes/_footer');
	}

	function import()
	{
		// echo '<pre>';
		// print_r($_FILES);
		// echo $_FILES["FILE"]["name"];
		if(isset($_FILES["FILE"]["name"]))
		{
			$path = $_FILES["FILE"]["tmp_name"];
			$object = PHPExcel_IOFactory::load($path);
			foreach($object->getWorksheetIterator() as $worksheet)
			{
				$highestRow = $worksheet->getHighestRow();
				$highestColumn = $worksheet->getHighestColumn();
				
				for($row=2; $row<=$highestRow; $row++)
				{
					$irla = $worksheet->getCellByColumnAndRow(0, $row)->getValue();
					$name = $worksheet->getCellByColumnAndRow(1, $row)->getValue();
					$mobile_no = $worksheet->getCellByColumnAndRow(2, $row)->getValue();
					$date_of_birth = $worksheet->getCellByColumnAndRow(3, $row)->getValue();
					// $birth = PHPExcel_Style_NumberFormat::toFormattedString($date_of_birth, "YYYY-M-D");
					$rank = $worksheet->getCellByColumnAndRow(4, $row)->getValue();
					$present_appoitment = $worksheet->getCellByColumnAndRow(5, $row)->getValue();
					$status = $worksheet->getCellByColumnAndRow(6, $row)->getValue();
					$location_name = $worksheet->getCellByColumnAndRow(7, $row)->getValue();
					$district_name = $worksheet->getCellByColumnAndRow(8, $row)->getValue();
					$state_name = $worksheet->getCellByColumnAndRow(9, $row)->getValue();
					$email_id = $worksheet->getCellByColumnAndRow(10, $row)->getValue();
					$data[] = array(
						'irla'				=>	$irla,
						'name'				=>	$name,
						'mobile_no'			=>	$mobile_no,
						'date_of_birth'		=>	$date_of_birth,
						'rank'				=>	$rank,
						'present_appoitment'=>	$present_appoitment,
						'status'			=>	$status,
						'location_name'		=>	$location_name,
						'district_name'		=>	$district_name,
						'state_name'		=>	$state_name,
						'email_id'			=>	$email_id
					);
				}
			}
			
			$this->import_model->insert($data);
			echo 'Data Imported successfully';
		}	
	}
}

	
