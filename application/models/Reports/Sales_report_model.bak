<?php 

defined('BASEPATH') OR exit('No direct script access allowed');

class Sales_report_model extends CI_Model{

public function sales_report($start_date,$end_date,$entity_id){
    
    $db=$this->db;
    $query= "SELECT od.cart_id,ca.firstname,cd.order_code,CONCAT(ld.brand,' ',ld.liquor_description,' ',ld.liquor_type,' ',ld.liquor_ml,'ml ') as Liquor_details,od.dispatch_quantity,od.dispatch_time,od.dispatch_total_cost_bottles
    FROM cart_details cd 
    INNER JOIN order_details od ON cd.id=od.cart_id
    INNER JOIN liquor_entity_mapping lem ON lem.id=od.liquor_entity_id
    INNER JOIN liquor_details ld ON ld.liquor_description_id=lem.liquor_description_id
    INNER JOIN ci_admin ca ON ca.admin_id=od.dispatch_by
    WHERE cd.ordered_to_entity_id='$entity_id' AND cd.is_order_delivered=1 AND DATE(od.dispatch_time) BETWEEN '$start_date' AND '$end_date'
    ORDER BY od.dispatch_time";
    $response=$db->query($query);
    $result=$response->result_array();
    return $result;

}

public function cost_data($start_date,$end_date,$entity_id){
    
    $db=$this->db;
    $query= "SELECT SUM(od.dispatch_quantity) AS total_quantity,SUM(od.dispatch_total_cost_bottles) AS total_sale
    FROM cart_details cd 
    INNER JOIN order_details od ON cd.id=od.cart_id
    INNER JOIN liquor_entity_mapping lem ON lem.id=od.liquor_entity_id
    INNER JOIN liquor_details ld ON ld.liquor_description_id=lem.liquor_description_id
    INNER JOIN ci_admin ca ON ca.admin_id=od.dispatch_by
    WHERE cd.ordered_to_entity_id='$entity_id' AND cd.is_order_delivered=1 AND DATE(od.dispatch_time) BETWEEN '$start_date' AND '$end_date'
    ORDER BY od.dispatch_time";
    $response=$db->query($query);
    $result=$response->result_array();
    return $result;

}

            
}